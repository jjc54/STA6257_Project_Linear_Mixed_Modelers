---
title: "Report"
subtitle: "Inhale, Exhale, Analyze: BMI's Imprint on Impulse Oscillometry Outcomes"
date: "today"
author: "Joshua J. Cook, M.S., ACRP-PM, CCRC, Syed Ahzaz H. Shah, B.S., Jacob Hernandez, B.S., Sara Basili, M.S." 
bibliography: references.bib
csl: asa.csl
---

# **1 Introduction**

Linear mixed-effects models (LMMs) are advanced statistical tools designed to analyze data that exhibit complex structures, such as hierarchical organization, repeated measures, and random effects. These models are particularly useful when data violate the assumptions of traditional ANOVA or regression methods, such as the independence of observations, homoscedasticity, and normality of residuals. LMMs accommodate intra-subject differences, allowing for both fixed effects, which are consistent across individuals, and random effects, which vary among subjects or groups.

The implementation of LMMs has been facilitated by various software packages and programming languages. Brown [@brown_introduction_2021] provides a comprehensive guide to implementing LMMs in R, a widely used statistical programming language, offering a step-by-step walkthrough of model syntax without delving deeply into complex mathematical foundations. Additionally, the lme4 package, as detailed by Bates et al. [@bates_fitting_2015], represents a significant evolution in computational methods for fitting mixed models, offering efficient tools and simplified modeling processes for R users, especially for models with crossed random effects. Pymer4, developed by Jolly [@jolly_pymer4_2018], bridges R and Python, offering Python users a flexible and integrated tool for linear mixed modeling by leveraging the capabilities of R's lme4 package. This tool enhances the analytical capabilities within the Python ecosystem, making advanced statistical methods more accessible to a broader audience.

LMMs find applications across various scientific domains, each with its unique data structures and analytical challenges. The paper by Lee and Shang [@lee_estimation_nodate] explores the impact of missing data on the estimation and selection in LMMs, highlighting the challenges and proposing a method to record missingness using an indicator-based matrix. This approach is critical for ensuring model accuracy in the presence of missing data, a common issue in real-world datasets. Wang et al. [@wang_statistical_2022] illustrate the application of LMMs in cardiothoracic surgery outcomes research, using a case study of homograft pulmonary valve replacement data to demonstrate the model's ability to handle repeated measurements and provide more nuanced understandings of clinical outcomes. Aarts et al [@aarts_2015] demonstrates mulilevel design experiements in neurscciene and how using linear models on multilevel data can result in increase in false positives. Magezi [@magezi_linear_2015] highlights the use of LMMs in within-participant psychology experiments, addressing the complexities of repeated measures and nested data structures common in psychological research. Harrison et al. [@harrison_brief_2018] and Bolker et al. [@bolker_generalized_2009] discuss the application of LMMs and generalized linear mixed models (GLMMs) in ecology, emphasizing their utility in analyzing ecological data that involve complex relationships and hierarchical data structures with GRU. Grueber et al [@grueber_2011] another ecology research, paper focuses on the model averaging and information theoritac with LMMS as an alternative to traditional null hypothesis testing. In the medical field, LMMs are employed to model pandemic-induced mortality changes, as demonstrated by Verbeeck et al. [@verbeeck_linear_2023], and to analyze longitudinal health-related quality of life data in cancer clinical trials, as discussed by Touraine et al. [@touraine_when_2023].

The paper "To transform or not to transform: using generalized linear mixed models to analyse reaction time data" by Lo and Andrews [@lo_transform_2015] challenges the common practice of transforming reaction time data in cognitive psychology, advocating for GLMMs as a more robust alternative. The "LEVEL" guidelines proposed by Monsalves et al. [@monsalves_level_2020] aim to standardize the reporting of multilevel data and analyses, enhancing comparability across studies. Piepho's study [@piepho_analysing_1999] on analyzing disease incidence data with GLMMs underscores the inadequacy of traditional methods like ANOVA for such data, highlighting GLMMs' flexibility. The simulation study by Pusponegoro et al. [@pusponegoro_linear_2017] on children's growth differences emphasizes the importance of choosing the appropriate covariance structure in LMMs for longitudinal data. Lastly, the framework introduced by Steibel et al. [@steibel_powerful_2009] for analyzing RT-PCR data with LMMs showcases the method's statistical power and flexibility, offering a significant advancement over traditional analysis methods. LMMs are used in a wide array of disciplines, but also in varying study designs, as shown in Table 1.

Table 1. Systematic Review of LMM Use-cases [@casals_methodological_2014]

![](images/LMM_uses.png)

The strengths of LMMs lie in their flexibility to model complex data structures and their ability to handle missing data, making them a powerful tool for a wide range of scientific inquiries. However, their application is not without challenges. Peng and Lu [@peng_model_2012] address the difficulty of variable selection and parameter estimation in LMMs, proposing an iterative procedure to improve model accuracy. Barr [@barr_random_2013] critiques existing guidelines for testing interactions within LMMs, proposing new guidelines to ensure more reliable results. The work by Tu [@tu_using_2015] on GLMMs for network meta-analyses showcases how mixed models have evolved to tackle complex data, enhancing the accuracy of combining different studies. On the other hand, Fokkema et al. [@fokkema_generalized_2021] introduce GLMM trees, merging machine learning with mixed models to improve predictions and analysis, particularly useful in mental health research. Despite their robustness, as noted by Schielzeth et al. [@schielzeth_robustness_2020], LMMs require careful evaluation of model assumptions and may present computational challenges, especially with high-dimensional datasets.

The literature reviewed here collectively emphasizes the versatility, robustness, and broad applicability of LMMs and GLMMs across various fields of research. Despite their advantages, the importance of careful model selection, acknowledgment of limitations, and the potential need for more complex models such as joint models in certain scenarios are also highlighted. As the use of LMMs continues to grow, the development of standardized processes, such as the LEVEL framework [@monsalves_level_2020] and the 10 protocol put forth by [@zuur_2016], and user-friendly tools will be crucial in ensuring the accurate and effective application of these models in research.

# **2 Methods**

## **2.1 Mathematical Foundations**

LMMs can be defined as:

$y=X\beta + Z\gamma + \epsilon$

where:

-   Y is the response vector.

-   X is the design matrix for fixed effects.

-   β is the vector of fixed effects (parameters associated with the entire population or certain repeatable levels of experimental factors).

-   Z is the design matrix for random effects.

-   γ is the vector of random effects (represent random deviations from the population parameters (β ) for different subjects or experimental units; i.e., the variability not explained by the fixed effects).

-   ϵ is the vector of residual errors.

Although more flexible than other methods such as ANOVA, there are several assumptions for LMMs:

1.  Random effects (γ) are assumed to follow a normal distribution with mean zero and variance-covariance matrix G.

    $\gamma \sim N(0,G)$

2.  Residual errors (ϵ ) are assumed to follow a normal distribution with mean zero and variance-covariance matrix R.

    $\epsilon \sim N(0,R)$

3.  Random effects (γ) and residual errors (ϵ ) are assumed to be independent.

## **2.2 Breakdown of Mathematical Foundations**

**\[PLACEHOLDER FOR LAYMANS TERMS EXPLANATIONS\]**

## **2.3 Sample Data Structure**

LMMs require a tidy data set where each variable is its has its columns and observations are rows. The data set can contain nulls but they still need to be handled whether they are omitted or imputed depends on the amount and which columns are affected. The lmer() function in the lme4 library will automatically drop any null values so it is important that data is inspected and visualized making any models

# **3 Analysis and Results**

## **3.1 Packages**

```{r}

if (!requireNamespace(c("tidyverse", "lme4", "nlme", "gt", "RefManageR", "DataExplorer", "gtsummary"), quietly = TRUE)) {
    install.packages(c("tidyverse", "lme4", "nlme", "gt", "RefManageR", "DataExplorer", "gtsummary"))
}

library(tidyverse)
library(lme4)
library(nlme)
library(gt)
library(RefManageR)
library(DataExplorer)
library(gtsummary)

#references <- ReadBib("references.bib")
#summary(references)
```

-   `tidyverse`: used for data wrangling and visualisation.

-   `lme4`: used for LMM within R.

-   `nlme`: used for nonlinear LMM (NLMM) within R.

-   `gt`: used for table generation.

-   `gtsummary`: used for summary table generation of descriptive statistics.

-   `RefManageR`: used for BibTex reference management.

## **3.2 Data Ingestion**

```{r}

# Load the dataset
BMI <- read.csv("data/BMI_IOS_SCD_Asthma.csv")
```

### **`BMI` from Kaggle (**[Impact of BMI on IOS measures on children (kaggle.com)](https://www.kaggle.com/datasets/utkarshx27/impact-of-bmi-on-ios-measures))

-   **Description**: This dataset is from a retrospective study to assess the impact of BMI on impulse oscillometry (IOS) estimates of airway resistance and reactance in children with sickle cell disease (C-SCD)

-   **Detailed Description**: The dataset comprises various attributes and measurements across its columns. Categorical variables, such as Group, Subject ID, Observation_number, Hydroxyurea, Asthma, ICS, LABA, and Gender, denote different groupings, individual subjects, and attributes like medication usage and gender. Numerical variables like Age (months), Height (cm), Weight (Kg), BMI, R5Hz_PP, R20Hz_PP, X5Hz_PP, and Fres_PP provide quantitative data on subjects’ characteristics and test results. Notably, the summary also identifies missing values, such as the 14 instances in the Fres_PP variable, which warrant consideration in subsequent analysis.These columns provide measurements and estimates related to airway resistance and reactance obtained using impulse oscillometry (IOS), which is a non-invasive method for assessing respiratory function. These parameters are valuable in understanding the impact of BMI on respiratory measures in children with sickle cell disease (C-SCD) and African-American children with asthma (C-Asthma) participating in the study.

-   **Why suitable for LMMs**: The dataset has multiple observations, over time, for the same set of participants.

## **3.2 Exploratory Data Analysis (EDA)**

```{r}

x <- BMI

str(x)

head(x)

variables <- colnames(x)

variables_table <- data.frame(
  Variable = variables,
  Description = c(
    "This column indicates the group to which the subject belongs. There are two groups in the study: children with sickle cell disease (C-SCD) and African-American children with asthma (C-Asthma).",
    "Each subject in the study is assigned a unique identifier or ID, which is listed in this column. The ID is used to differentiate between individual participants.",
    "This column represents the number assigned to each observation or measurement taken for a particular subject. Since this is a longitudinal study, multiple observations may be recorded for each subject over time.",
    "This column indicates whether the subject with sickle cell disease (C-SCD) received hydroxyurea treatment. Hydroxyurea is a medication commonly used for the treatment of sickle cell disease.",
    "This column indicates whether the subject has a diagnosis of asthma. It distinguishes between children with sickle cell disease (C-SCD) and African-American children with asthma (C-Asthma).",
    "This column indicates whether the subject is using inhaled corticosteroids (ICS). ICS is a type of medication commonly used for the treatment of asthma and certain other respiratory conditions.",
    "This column indicates whether the subject is using a long-acting beta-agonist (LABA). LABA is a type of medication often used in combination with inhaled corticosteroids for the treatment of asthma.",
    "This column represents the gender of the subject, indicating whether they are male or female",
    "This column specifies the age of the subject at the time of the observation or measurement. Age is typically measured in months.",
    "This column represents the height of the subject, typically measured in a standard unit of length, such as centimeters or inches. Height is an important variable to consider in assessing the impact of BMI on respiratory measures.",
    "This column indicates the weight of the subject at the time of the observation or measurement. Weight is typically measured in kilograms (Kg) and is an important variable for calculating the body mass index (BMI).",
    "Body Mass Index (BMI) is a measure that assesses body weight relative to height. It is calculated by dividing the weight of an individual (in kilograms) by the square of their height (in meters). The BMI column provides the calculated BMI value for each subject based on their weight and height measurements. BMI is commonly used as an indicator of overall body fatness and is often used to classify individuals into different weight categories (e.g., underweight, normal weight, overweight, obese).",
    "This column represents the estimate of airway resistance at 5 Hz using impulse oscillometry (IOS). Airway resistance is a measure of the impedance encountered by airflow during respiration. The R5Hz_PP value indicates the airway resistance at the frequency of 5 Hz and is obtained through the IOS testing.",
    "This column represents the estimate of airway resistance at 20 Hz using impulse oscillometry (IOS). Similar to R5Hz_PP, R20Hz_PP provides the measure of airway resistance at the frequency of 20 Hz based on the IOS testing.",
    "This column represents the estimate of airway reactance at 5 Hz using impulse oscillometry (IOS). Airway reactance is a measure of the elasticity and stiffness of the airway walls. The X5Hz_PP value indicates the airway reactance at the frequency of 5 Hz and is obtained through the IOS testing.",
    "This column represents the estimate of resonant frequency using impulse oscillometry (IOS). Resonant frequency is a measure of the point at which the reactance of the airways transitions from positive to negative during respiration. The Fres_PP value indicates the resonant frequency and is obtained through the IOS testing.:"
    )
)

variables_table %>%
  gt %>%
  tab_header(
    title = "Variable Description"
  )
  
plot_str(x)
introduce(x)
plot_intro(x)
```

### **3.2.1 Missing Values**

```{r}

plot_missing(x)
```

Based on the missing values count, it appears that there are no missing values in most of the columns, except for Fres_PP, where there are 14 missing values (6.39%). In this case, omitting missing values for Fres_PP is reasonable, considering the small proportion of missing data compared to the total number of observation

### 3.2.2 Cleaning Data

```{r}

dim(x)
 
x_clean <- na.omit(x) # drops NAs, further analysis is without NA values

dim(x_clean)
str(x_clean)
plot_bar(x_clean)
plot_histogram(x_clean)
plot_qq(na.omit(x))
plot_prcomp(na.omit(x))

numeric_vars <- x_clean %>% 
  select_if(is.numeric)

# Boxplot for each numeric variable
par(mfrow=c(2, 2))
for (col in colnames(numeric_vars)) {
  boxplot(numeric_vars[[col]], main=col)
}
```

Based on the boxplot, it’s evident that all columns except “Age (months)” and “Height (cm)” contain outliers. Now, let’s pinpoint these outliers.

```{r}

# Define a function to detect outliers in each column
detect_outliers <- function(column) {
  Q1 <- quantile(column, 0.25)
  Q3 <- quantile(column, 0.75)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  outliers <- column[column < lower_bound | column > upper_bound]
  return(outliers)
}

# Iterate over each column and print outliers; not removed
for (col in names(numeric_vars)) {
  outliers <- detect_outliers(numeric_vars[[col]])
  if (length(outliers) > 0) {
    cat("Outliers in", col, ":\n")
    print(outliers)
    cat("\n")
  }
}

x_clean %>% 
  select(-2) %>%
  tbl_summary( #gtSummary Table
    by=Group,
    type = list(
      c('Age..months.', 'Height..cm.', 'Weight..Kg.', 'BMI', 'R5Hz_PP', 'R20Hz_PP', 'X5Hz_PP', 'Fres_PP') ~ 'continuous2'),
    statistic = all_continuous2() ~ c(
                       "{mean} ± {sd}",
                       "{median} ({p25}, {p75})",
                       "{min}, {max}"
                       ),
    digits = all_continuous2() ~ 2,
    missing="ifany",
  ) %>%
  bold_labels %>%
  italicize_levels() %>%
  as_gt() %>%
  tab_header(
    title = "Summary Statistics"
  )
```

### 3.2.3 Correlations

```{r}
plot_correlation(na.omit(x), maxcat=5L)

correlation_matrix <- cor(numeric_vars)
print(correlation_matrix)
```

Age (months) and Height (cm): There is a strong positive correlation (0.914) between Age (months) and Height (cm). This implies that as age increases, height tends to increase as well. This correlation is expected, as children tend to grow taller as they get older.

Weight (Kg) and BMI: There is a strong positive correlation (0.927) between Weight (Kg) and BMI. This suggests that as weight increases, BMI (Body Mass Index) tends to increase as well. This correlation is expected because BMI is calculated using weight and height measurements.

R5Hz_PP and Fres_PP: There is a strong positive correlation (0.754) between R5Hz_PP and Fres_PP.

## **3.3 Linear Mixed Modeling**

```{r}

```

## **3.4 Model Comparisons and Assessment**

```{r}

```

## **3.5 Simulation (POSSIBLY)**

```{r}

```

# **4 Conclusion**

**\[PLACEHOLDER FOR CONCLUSION\]**

# **5 References**

::: {#refs}
:::
